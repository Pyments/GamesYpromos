require_relative "../lib/GamesYpromos"

DB_CONFIG = {
  dbname:   "gamesypromos",
  user:     "gamesypromos",
  password: "gamesypromos",
  host:     "localhost",
  port:     5432
}

def main
  puts "Iniciando GamesYpromos CLI..."
  
  begin
    api_client = Services::ApiClient.new
    db         = Models::DB.new(DB_CONFIG)
    menu       = CLI::Menu.new(api_client, db)
    menu.start
  rescue PG::ConnectionBad => e
    puts "Falha na conexão com o banco de dados: #{e.message}"
    puts "Certifique-se de que o PostgreSQL está rodando e o banco existe."
    puts "Execute: psql -f db/schema.sql para criar o banco e a tabela."
    exit 1
  rescue => e
    puts "Erro: #{e.message}"
    exit 1
  ensure
    db&.close
  end
end

if __FILE__ == $0
  main
end
